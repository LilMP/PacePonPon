<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PacePonPon</title>
    <link rel="stylesheet" href="main.css">
</head>
<body>
    <h1>Pace朋朋: 你的配速好朋友</h1>
    <input type="radio" onchange="ChangeOption(this)" id="c_pace" name="type" value="pace" checked><label for="pace">配速</label><input type="text" name="" id="pace_input" placeholder="ex: 3:15" size="5" maxlength="4" onclick="this.select()">/km<br>
    <input type="radio" onchange="ChangeOption(this)" id="c_track" name="type" value="track"><label for="track">操場</label><input type="number" name="" id="track_input" placeholder="ex: 84" size="4" maxlength="4" onclick="this.select()" disabled>秒/圈<br>
    <input type="radio" onchange="ChangeOption(this)" id="c_treadmill" name="type" value="treadmill"><label for="treadmill">跑步機</label><input type="number" name="" id="treadmill_input" placeholder="ex: 15" size="4" maxlength="4" onclick="this.select()" disabled>km/h<br>
    <button class="" id='calBtn' onclick="Calculate()">Enter</button>
</body>

<script type="text/javascript" src="strftime-min.js"></script>

<script>   
    var ui_pace_text = document.getElementById('pace_input');
    var ui_track_text = document.getElementById('track_input');
    var ui_treadmill_text = document.getElementById('treadmill_input');
    
    // 沒選到不能輸入
    function DisableTextBox(e){
        var checkid = e.id;
        // console.log(checkid);

        ui_pace_text.disabled = true;
        ui_track_text.disabled = true;
        ui_treadmill_text.disabled = true;

        if (checkid == 'c_pace') {
            ui_pace_text.disabled = false;
        } else if (checkid == 'c_track') {
            ui_track_text.disabled = false;
        } else if (checkid == 'c_treadmill') {
            ui_treadmill_text.disabled = false;
        }
    }

    // 清掉輸入紀錄
    function CleanTextBox(){
        ui_pace_text.value = "";
        ui_track_text.value = "";
        ui_treadmill_text.value = "";
    }

    // 切換選項的動作: 1.把沒選到的disable 2.清掉輸入紀錄
    function ChangeOption(e) {
        DisableTextBox(e);
        CleanTextBox();
    }

    // 按下enter後執行計算
    function Calculate() {

        // 取目前的input值
        let pace_input = ui_pace_text.value;
        let track_input = ui_track_text.value;
        let treadmill_input = ui_treadmill_text.value;
        // console.log(pace_input)
        // console.log(track_input)
        // console.log(treadmill_input)

        // 找到被選的選項
        checked = document.querySelector('input[name="type"]:checked').value;
        // console.log(checked);
        
        let pace_result, track_result, treadmill_result;

        

        if (checked == 'pace') {
            var hms = pace_input;   // your input string
            var a = hms.split(':'); // split it at the colons
            var seconds = Number(a[0])*60+Number(a[1]);
            
            // var track_lap_sec = seconds/2.5;
            // console.log("track: "+track_lap_sec);
            track_result = seconds/2.5;

            // var km_hr = Math.round(1440/track_lap_sec*100)/100;
            // console.log("treadmill: "+km_hr);
            treadmill_result = Math.round(1440/track_result*100)/100;

            // console.log("track: "+track_result);
            // console.log("treadmill: "+treadmill_result);
            
            // update 結果
            document.getElementById('track_input').value = track_result;
            document.getElementById('treadmill_input').value = treadmill_result;
            
        }
        else if (checked == 'track') {
            var seconds = track_input*2.5;
            // new Date(year, month, day, hours, minutes, seconds, milliseconds);
            // var mm_ss_str = strftime('%M:%S', new Date(0,0,0,0,0,seconds));
                // var date = new Date(0,0,0,0,0,seconds);
                // var mm_ss_str = strftime("%M:%S", date);
            // console.log("pace: "+mm_ss_str);
            pace_result = strftime('%M:%S', new Date(0,0,0,0,0,seconds));

            // var km_hr = Math.round(1440/track_input*100)/100;
            // console.log("treadmill: "+km_hr);
            treadmill_result = Math.round(1440/track_input*100)/100;

            // console.log("pace: "+pace_result);
            // console.log("treadmill: "+treadmill_result);

            // update 結果
            document.getElementById('pace_input').value = pace_result;
            document.getElementById('treadmill_input').value = treadmill_result;
            
        }
        else if (checked == 'treadmill') {
            
            // var track_sec = Math.round(1440/treadmill_input*100)/100;
            // console.log("track: "+track_sec);
            track_result = Math.round(1440/treadmill_input*100)/100;

            // var pace_mm_ss = strftime('%M:%S', new Date(0,0,0,0,0,track_sec*2.5));
            // console.log("pace: "+pace_mm_ss);
            pace_result = strftime('%M:%S', new Date(0,0,0,0,0,track_result*2.5));

            // console.log("track: "+track_result);
            // console.log("pace: "+pace_result);

            // update 結果
            document.getElementById('pace_input').value = pace_result;
            document.getElementById('track_input').value = track_result;
            
        }
        else {
            console.log('something\'s wrong')
        }
    }
</script>
</html>